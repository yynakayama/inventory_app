# 在庫管理システム - 画面仕様書（詳細版）

## 📋 文書概要

**作成日**: 2025年8月1日  
**最終更新**: 2025年8月1日  
**作成者**: フルリモートエンジニア候補  
**ステータス**: 詳細仕様確定版  

### 目的
フロントエンド詳細設計書をベースに、各画面の具体的な機能・UI・UX仕様を明確化し、開発時の指針とする。

---

## 🎯 全画面構成（合計26画面）

### 🔐 認証関連（1画面）
| 画面ID | 画面名 | URL | 権限 | Phase |
|--------|--------|-----|------|-------|
| AUTH001 | ログイン画面 | `/login` | なし | 完了 |

### 🏠 ダッシュボード（2画面）
| 画面ID | 画面名 | URL | 権限 | Phase |
|--------|--------|-----|------|-------|
| DASH001 | メインダッシュボード | `/` | 全員 | Phase 3 |
| DASH002 | 詳細ダッシュボード | `/dashboard` | 全員 | Phase 3 |

### 📦 在庫管理（4画面）
| 画面ID | 画面名 | URL | 権限 | Phase |
|--------|--------|-----|------|-------|
| INV001 | 在庫管理トップ | `/inventory` | 全員 | Phase 2 |
| INV002 | 在庫一覧 | `/inventory/list` | 全員 | Phase 2 |
| INV003 | 統合入荷処理 | `/inventory/receipt` | 資材・管理者 | Phase 2 |
| INV004 | 取引履歴 | `/inventory/transactions` | 全員 | Phase 2 |

### 🏭 生産計画管理（4画面）
| 画面ID | 画面名 | URL | 権限 | Phase |
|--------|--------|-----|------|-------|
| PROD001 | 生産管理トップ | `/production` | 生産・管理者 | Phase 4 |
| PROD002 | 生産計画一覧 | `/production/plans` | 生産・管理者 | Phase 4 |
| PROD003 | 所要量計算 | `/production/requirements` | 生産・管理者 | Phase 4 |
| PROD004 | BOM管理 | `/production/bom` | 生産・管理者 | Phase 4 |

### 🚚 調達管理（3画面）
| 画面ID | 画面名 | URL | 権限 | Phase |
|--------|--------|-----|------|-------|
| PROC001 | 調達管理トップ | `/procurement` | 資材・生産・管理者 | Phase 5 |
| PROC002 | 予定入荷管理 | `/procurement/scheduled-receipts` | 資材・生産・管理者 | Phase 5 |
| PROC003 | 発注アラート | `/procurement/alerts` | 資材・生産・管理者 | Phase 5 |

### 🗃️ マスタ管理（5画面）
| 画面ID | 画面名 | URL | 権限 | Phase |
|--------|--------|-----|------|-------|
| MAST001 | マスタ管理トップ | `/masters` | 管理者 | Phase 6 |
| MAST002 | 部品マスタ一覧 | `/masters/parts` | 管理者 | Phase 6 |
| MAST003 | 製品マスタ一覧 | `/masters/products` | 管理者 | Phase 6 |
| MAST004 | BOMマスタ管理 | `/masters/bom` | 管理者 | Phase 6 |
| MAST005 | ユーザー管理 | `/masters/users` | 管理者 | Phase 6 |

### 📊 レポート（4画面）
| 画面ID | 画面名 | URL | 権限 | Phase |
|--------|--------|-----|------|-------|
| REP001 | レポートトップ | `/reports` | 全員 | Phase 7 |
| REP002 | 在庫レポート | `/reports/inventory` | 全員 | Phase 7 |
| REP003 | 不足分析レポート | `/reports/shortage` | 全員 | Phase 7 |
| REP004 | ダッシュボードレポート | `/reports/dashboard` | 全員 | Phase 7 |

### 🚨 エラー・共通（3画面）
| 画面ID | 画面名 | URL | 権限 | Phase |
|--------|--------|-----|------|-------|
| ERR001 | 404ページ | `/not-found` | なし | Phase 1 |
| ERR002 | 共通ローディング | `/loading` | なし | Phase 1 |
| ERR003 | 共通エラー | `/error` | なし | Phase 1 |

---

## 📋 Phase 2: 在庫管理画面詳細仕様

### 🏠 INV001: 在庫管理トップ画面

#### 基本情報
- **URL**: `/inventory`
- **権限**: 全ユーザー
- **目的**: 在庫管理機能へのエントランス・概要表示

#### 画面構成
```
┌─────────────────────────────────────┐
│ 🏠 在庫管理                        │
├─────────────────────────────────────┤
│ [📊 在庫一覧] [📥 統合入荷] [📜 履歴] │
│                                     │
│ ■ 在庫サマリー                     │
│ ・総部品数: 1,234件                │
│ ・在庫不足: 12件                   │
│ ・最終更新: 2025-08-01 14:30      │
│                                     │
│ ■ 最近の活動 (管理者・資材のみ)    │
│ ・入荷処理: SUS304-M6 +50個       │
│ ・調整処理: ALU-PLATE -5個         │
└─────────────────────────────────────┘
```

#### 機能詳細
1. **メニューカード**
   - 在庫一覧：全ユーザー表示
   - 統合入荷処理：資材・管理者のみ表示
   - 取引履歴：全ユーザー表示

2. **在庫サマリー表示**
   - 総部品数（アクティブな部品のみ）
   - 在庫不足件数（安全在庫を下回る部品）
   - 最終更新日時

3. **最近の活動（権限制御）**
   - 資材・管理者：入荷・出庫・調整の履歴5件表示
   - 閲覧者・生産管理者：非表示

#### 使用API
- `GET /api/inventory/summary` - 在庫サマリー取得
- `GET /api/inventory/recent-activities` - 最近の活動取得

---

### 📋 INV002: 在庫一覧画面

#### 基本情報
- **URL**: `/inventory/list`
- **権限**: 全ユーザー
- **目的**: 現在の在庫状況を一覧表示・検索・フィルタ

#### 画面構成
```
┌─────────────────────────────────────────────────┐
│ 📋 在庫一覧                                     │
├─────────────────────────────────────────────────┤
│ 🔍 [部品コード] [部品名] [保管場所▼] [在庫不足☑] │
│ [検索] [リセット]                    [CSV出力]  │
├─────────────────────────────────────────────────┤
│ 部品コード │ 部品名 │ 現在庫 │ 利用可能 │ 場所 │  │
│ SUS304-M6  │ ステン │   150  │   120   │ A-01 │  │
│ ALU-PLATE  │ アルミ │    45  │    45   │ B-02 │⚠│
└─────────────────────────────────────────────────┘
│ 1-50 / 1,234件    [前へ] [1] [2] [3] ... [次へ] │
└─────────────────────────────────────────────────┘
```

#### 機能詳細

##### 1. 検索・フィルタ機能
- **部品コード検索**: 前方一致・部分一致
- **規格・仕様検索**: 部分一致（ひらがな・カタカナ対応）
- **カテゴリフィルタ**: ドロップダウン選択
- **在庫不足フィルタ**: チェックボックス（安全在庫以下）

##### 2. テーブル表示
| 列名 | 表示内容 | ソート | 備考 |
|------|----------|--------|------|
| 部品コード | part_code | ○ | クリックで詳細画面 |
| 規格・仕様 | specification | ○ | 部品の詳細説明 |
| 現在庫数 | current_stock | ○ | 単位表示 |
| 予約済数 | reserved_stock | ○ | 生産計画予約分 |
| 利用可能数 | current_stock - reserved_stock | ○ | 計算値 |
| 単位 | unit | - | 固定で「個」 |
| ステータス | - | - | 在庫不足アイコン |
| 操作 | - | - | 詳細・履歴ボタン |

##### 3. ページネーション
- 1ページ50件表示（設定変更可能）
- 総件数・現在位置表示
- 前へ/次へ + ページ番号選択

##### 4. CSV出力機能
- 検索結果をCSV形式でダウンロード
- ファイル名: `inventory_YYYYMMDD_HHMMSS.csv`

#### 使用API
- `GET /api/inventory` - 在庫一覧取得（parts テーブルと JOIN）
- `GET /api/inventory/export` - CSV出力

#### 権限による表示制御
- **全ユーザー**: 閲覧・検索・CSV出力
- **操作ボタン**: 権限に応じて表示/非表示

---

### 📥 INV003: 統合入荷処理画面

#### 基本情報
- **URL**: `/inventory/receipt`
- **権限**: 資材担当・管理者のみ
- **目的**: 新しい在庫の入荷処理・予定入荷との連携

#### 画面構成
```
┌─────────────────────────────┬─────────────────────┐
│ 📥 統合入荷処理              │ 📊 現在の在庫情報   │
├─────────────────────────────┤                     │
│ ■ 入荷情報入力              │ 現在庫数: 120個     │
│                             │ 予約済数: 30個      │
│ 部品コード: [SUS304-M6] [🔍]│ 利用可能: 90個      │
│ 規格・仕様: [M6ステンボルト]│ 安全在庫: 50個      │
│                             │ 単価: 120.5円       │
│ 入荷数量: [50]個            │                     │
│ 単価: [120.5]円            │ ⚠️ 処理の注意事項   │
│ 入荷日: [2025-08-01]       │ • 処理は取消不可    │
│                             │ • 予定入荷と連携    │
│ サプライヤー: [○○商事]     │ • 履歴に記録される  │
│ 予定入荷ID: [123] (任意)    │                     │
│                             │ 📜 最近の入荷履歴   │
│ 備考: [品質良好]           │ 07/30: +30個        │
│                             │ 07/28: +100個       │
│ [クリア] [入荷処理実行]     │                     │
└─────────────────────────────┴─────────────────────┘
```

#### 機能詳細

##### 1. 部品選択機能
- **部品コード入力**: 手動入力 + 検索ボタン
- **部品検索**: モーダルで部品一覧から選択
- **自動補完**: 規格・仕様・単価等の自動表示（partsテーブルから取得）

##### 2. 入荷情報入力
| 項目 | 必須 | バリデーション | 備考 |
|------|------|----------------|------|
| 部品コード | ✓ | 存在チェック | - |
| 入荷数量 | ✓ | 正の整数 | - |
| 単価 | - | 正の数値 | マスタ単価がデフォルト |
| 入荷日 | ✓ | 日付形式 | 今日がデフォルト |
| サプライヤー | - | 文字列 | - |
| 予定入荷ID | - | 数値 | 連携時のみ |
| 備考 | - | 500文字以内 | - |

##### 3. サイドバー情報
- **現在の在庫情報**: リアルタイム表示（inventoryテーブル + partsテーブル）
- **処理の注意事項**: 固定表示
- **最近の入荷履歴**: 直近5件表示（inventory_transactionsテーブル）

##### 4. 処理実行
- **バリデーション**: クライアント + サーバーサイド
- **確認ダイアログ**: 処理内容の最終確認
- **成功時**: 成功メッセージ + 在庫情報更新
- **エラー時**: エラーメッセージ + 修正指示

#### 使用API
- `GET /api/parts/search` - 部品検索（partsテーブル）
- `GET /api/inventory/{part_code}` - 在庫詳細取得（inventory + parts JOIN）
- `POST /api/inventory/{part_code}/integrated-receipt` - 統合入荷処理
- `GET /api/inventory/{part_code}/recent-receipts` - 最近の入荷履歴

#### 予定入荷連携
- 予定入荷IDを指定すると自動的に予定入荷と照合
- 予定数量と実績の差分管理
- ステータス自動更新（入荷予定 → 入荷済み）

---

### 📜 INV004: 取引履歴画面

#### 基本情報
- **URL**: `/inventory/transactions`
- **権限**: 全ユーザー
- **目的**: 在庫の増減履歴を詳細に確認・分析

#### 画面構成
```
┌─────────────────────────────────────────────────┐
│ 📜 取引履歴                                     │
├─────────────────────────────────────────────────┤
│ 🔍 [部品コード] [取引種別▼] [期間From] [期間To] │
│ [検索] [リセット]                    [CSV出力]  │
├─────────────────────────────────────────────────┤
│日時│部品コード│取引種別│数量│単価│サプライヤー│備考│
│08/01 14:30│SUS304-M6│入荷│+50│120.5│○○商事│品質良好│
│08/01 10:15│ALU-PLATE│出庫│-10│85.0│-│生産投入│
│07/31 16:45│SUS304-M6│調整│-2│-│-│不良発見│
└─────────────────────────────────────────────────┘
│ 1-20 / 5,678件    [前へ] [1] [2] [3] ... [次へ] │
└─────────────────────────────────────────────────┘
```

#### 機能詳細

##### 1. 検索・フィルタ機能
- **部品コード検索**: 前方一致
- **取引種別フィルタ**: 入荷/出庫/調整/予約/予約解除
- **期間指定**: 開始日〜終了日
- **サプライヤー検索**: 部分一致（入荷取引のみ）

##### 2. テーブル表示
| 列名 | 表示内容 | ソート | 備考 |
|------|----------|--------|------|
| 取引日時 | transaction_date | ○ | YYYY/MM/DD HH:MM形式 |
| 部品コード | part_code | ○ | - |
| 規格・仕様 | parts.specification | - | JOINで取得・省略表示 |
| 取引種別 | transaction_type | ○ | 色分け表示 |
| 数量 | quantity | ○ | +/-符号付き |
| 単価 | parts.unit_price | - | 円表示・JOINで取得 |
| 参照元 | reference_id, reference_type | - | 生産計画ID等 |
| 備考 | remarks | - | 省略表示 |

##### 3. 取引種別の色分け
- **入荷**: 🟢 緑色
- **出庫**: 🔴 赤色  
- **調整**: 🟡 黄色
- **予約**: 🔵 青色
- **予約解除**: ⚪ グレー

##### 4. CSV出力機能
- 検索結果をCSV形式でダウンロード
- ファイル名: `transactions_YYYYMMDD_HHMMSS.csv`

#### 使用API
- `GET /api/inventory/transactions` - 取引履歴取得（inventory_transactions + parts JOIN）
- `GET /api/inventory/transactions/export` - CSV出力

#### 権限による表示制御
- **全ユーザー**: 閲覧・検索・CSV出力
- **詳細情報**: 権限に応じて表示レベル調整

---

## 🎨 共通UI仕様

### デザインシステム
```css
/* カラーパレット */
:root {
  --primary-50: #eff6ff;
  --primary-500: #3b82f6;
  --primary-600: #2563eb;
  --success-500: #22c55e;
  --warning-500: #f59e0b;
  --danger-500: #ef4444;
  --gray-50: #f9fafb;
  --gray-500: #6b7280;
  --gray-900: #111827;
}

/* 共通コンポーネントクラス */
.btn-primary { /* プライマリボタン */ }
.btn-secondary { /* セカンダリボタン */ }
.btn-danger { /* 危険操作ボタン */ }
.card-base { /* カード型コンテナ */ }
.input-base { /* 入力フィールド */ }
.table-base { /* テーブル */ }
```

### レスポンシブ対応
- **デスクトップ**: 1280px以上（フル機能）
- **タブレット**: 768px-1279px（主要機能）
- **スマホ**: 767px以下（基本機能のみ）

### アクセシビリティ
- カラーコントラスト比: WCAG AA準拠
- キーボード操作: Tab順序の最適化
- スクリーンリーダー: 適切なaria-label設定

---

## 🔧 技術実装要件

### パフォーマンス要件
- **初期表示**: 3秒以内
- **検索結果**: 2秒以内
- **画面遷移**: 1秒以内

### セキュリティ要件
- **JWT認証**: 全API通信でトークン検証
- **権限制御**: ページ・UI要素レベルでの制御
- **入力検証**: クライアント + サーバーサイド両方

### エラーハンドリング
- **ネットワークエラー**: 再試行ボタン表示
- **権限エラー**: 適切なメッセージと代替操作
- **バリデーションエラー**: 項目別エラー表示

---

## 📅 開発スケジュール

### Phase 2: 在庫管理画面（Week 3-5）
- **Week 3**: INV001, INV002 実装
- **Week 4**: INV003 実装  
- **Week 5**: INV004 実装 + テスト

### 次フェーズ準備
- **共通コンポーネント**: Button, Table, Modal等
- **API Service層**: 各画面共通の通信処理
- **状態管理**: React Query設定

---

## ✅ 承認・確認事項

### 仕様確認必要項目
- [ ] 在庫不足の基準（安全在庫基準で良いか）
- [ ] CSV出力項目（現在の項目で十分か）
- [ ] 予定入荷連携の詳細フロー
- [ ] 権限制御の細かい制御レベル

### 技術的確認事項
- [ ] バックエンドAPI仕様との整合性
- [ ] データベーステーブル構造との整合性
- [ ] 既存認証システムとの連携
