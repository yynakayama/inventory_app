# 在庫管理システム - フロントエンド詳細設計書 (2025/09/12 更新版)

## 🎯 設計概要

### システム全体像
- **バックエンド**: Node.js + Express + MySQL（完成済み）
- **フロントエンド**: Next.js (App Router) + React + TypeScript
- **API**: JWT認証 + 4段階権限管理
- **Docker環境**: フロントエンド（ポート3001）、バックエンド（ポート3000）

### 技術スタック
- **Framework**: Next.js (App Router)
- **Language**: TypeScript
- **Styling**: Tailwind CSS
- **State Management**: React Context API (認証), `useState`, `useEffect` (ローカル状態)
- **API Client**: `fetch` API
- **Permissions**: Custom Hooks (`useProductionPermissions`)

---

## 📂 フォルダ構成設計 (現状ベース)

```
src/
├── app/                         # App Router
│   ├── (auth)/login/page.tsx   # ログイン画面
│   ├── api/health/route.ts     # ヘルスチェックAPI
│   ├── dashboard/page.tsx      # ダッシュボード画面
│   ├── inventory/page.tsx      # 在庫管理画面
│   ├── procurement/page.tsx    # 調達管理画面
│   ├── production/page.tsx     # 生産計画画面
│   ├── layout.tsx              # 共通レイアウト
│   ├── page.tsx                # トップページ
│   └── globals.css             # グローバルスタイル
├── components/                # 再利用可能コンポーネント
│   ├── dashboard/
│   │   ├── AlertCard.tsx
│   │   └── KPICard.tsx
│   ├── guards/
│   │   ├── PermissionGuard.tsx # UIレベルの権限制御
│   │   └── RouteGuard.tsx      # ページレベルの権限制御
│   ├── layout/
│   │   ├── ClientLayoutWrapper.tsx
│   │   ├── Header.tsx
│   │   └── MainLayout.tsx
│   ├── procurement/
│   │   ├── SearchFilters.tsx
│   │   └── StatusBadge.tsx
│   ├── production/
│   │   ├── ProductionPlanForm.tsx
│   │   ├── SearchFilters.tsx
│   │   └── StatusBadge.tsx
│   └── ui/
│       ├── Button.tsx
│       ├── Modal.tsx
│       └── PartCodeSelector.tsx
├── hooks/                     # カスタムフック
│   └── useProductionPermissions.ts # 生産計画画面の権限管理
├── lib/                       # ユーティリティ・設定
│   ├── api.ts                 # API基本設定 (現状は未使用)
│   └── utils.ts               # 汎用ユーティリティ (cn関数など)
├── providers/                 # Provider
│   └── AuthProvider.tsx       # 認証状態管理
├── types/                     # TypeScript型定義
│   ├── procurement.ts         # 調達関連の型
│   └── production.ts          # 生産関連の型
└── utils/                     # ヘルパー関数
    └── tableRowColors.ts      # テーブル行の色分け
```

---

## 🔐 認証・権限設計

### 権限レベル定義
- `admin`: 全権限
- `production_manager`: 生産、在庫閲覧
- `material_staff`: 在庫、調達
- `viewer`: 閲覧のみ

### 権限制御コンポーネント
- **`RouteGuard.tsx`**: ページ単位でのアクセス制御。未認証ユーザーや権限のないユーザーをログインページにリダイレクトする。
- **`PermissionGuard.tsx`**: ボタンやフォームなど、UI要素単位での表示・非表示を制御する。

---

## 📡 API連携設計

### 基本方針
- 各ページの`useEffect`内で`fetch` APIを直接使用してデータ取得を行う。
- 認証が必要なAPIには、`localStorage`から取得したJWTトークンを`Authorization`ヘッダーに付与する。
- エラーハンドリングは各コンポーネント内で`try-catch`ブロックを使用して実装。

### 主要APIエンドポイント
- **Dashboard**: `GET /api/reports/dashboard`
- **Inventory**: `GET /api/inventory`, `POST /api/inventory/:part_code/receipt`, `POST /api/inventory/:part_code/issue`, `POST /api/stocktaking/execute`
- **Procurement**: `GET /api/scheduled-receipts`, `POST /api/scheduled-receipts`, `PUT /api/scheduled-receipts/:id/delivery-response`, `POST /api/inventory/:part_code/integrated-receipt`
- **Production**: `GET /api/plans`, `POST /api/plans`, `POST /api/plans/:id/requirements`, `POST /api/plans/:id/start-production`

---

## 🚀 開発フェーズ計画 (更新版)

### Phase 1: 認証・基盤（完了）
- [x] 認証システム実装 (ログイン、権限制御)
- [x] 共通レイアウト実装
- [x] 基本UIコンポーネント実装 (Button, Modal)

### Phase 2: 主要機能実装（完了）
- [x] ダッシュボード画面
- [x] 在庫管理画面 (一覧、詳細、調整、棚卸)
- [x] 調達管理画面 (一覧、発注、納期回答、入荷)
- [x] 生産計画画面 (一覧、作成、所要量計算、ステータス更新)

### Phase 3: マスタ管理（最終フェーズ）
- [ ] 部品マスタ管理画面
- [ ] 製品マスタ・BOM管理画面
- [ ] ユーザー管理画面 (管理者向け)

### Phase 4: テスト・最適化
- [ ] 単体・結合テストの実装
- [ ] E2Eテストの実装
- [ ] パフォーマンス最適化

### 将来拡張
- [ ] レポート機能

---