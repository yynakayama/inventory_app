# 在庫管理システム - 画面仕様書（詳細版）

## 📋 文書概要

**作成日**: 2025年8月1日  
**最終更新**: 2025年8月1日  
**作成者**: フルリモートエンジニア候補  
**ステータス**: 詳細仕様確定版  

### 目的
フロントエンド詳細設計書をベースに、各画面の具体的な機能・UI・UX仕様を明確化し、開発時の指針とする。

---

## 🎯 全画面構成（合計26画面）

### 🔐 認証関連（1画面）
| 画面ID | 画面名 | URL | 権限 | Phase |
|--------|--------|-----|------|-------|
| AUTH001 | ログイン画面 | `/login` | なし | 完了 |

### 🏠 ダッシュボード（2画面）
| 画面ID | 画面名 | URL | 権限 | Phase |
|--------|--------|-----|------|-------|
| DASH001 | メインダッシュボード | `/` | 全員 | Phase 2 |
| DASH002 | 詳細ダッシュボード | `/dashboard` | 全員 | Phase 2 |

### 📦 在庫管理（4画面）
| 画面ID | 画面名 | URL | 権限 | Phase |
|--------|--------|-----|------|-------|
| INV001 | 在庫管理トップ | `/inventory` | 全員 | Phase 2 |
| INV002 | 在庫一覧 | `/inventory` | 全員 | Phase 2 |
| INV003 | 統合入荷処理 | - | 資材・管理者 | (廃止) |
| INV004 | 取引履歴 | (在庫一覧に統合) | 全員 | Phase 2 |

### 🏭 生産計画管理（4画面）
| 画面ID | 画面名 | URL | 権限 | Phase |
|--------|--------|-----|------|-------|
| PROD001 | 生産管理トップ | `/production` | 生産・管理者 | Phase 2 |
| PROD002 | 生産計画一覧 | `/production` | 生産・管理者 | Phase 2 |
| PROD003 | 所要量計算 | (生産計画に統合) | 生産・管理者 | Phase 2 |
| PROD004 | BOM管理 | `/masters/bom` | 生産・管理者 | Phase 3 |

### 🚚 調達管理（3画面）
| 画面ID | 画面名 | URL | 権限 | Phase |
|--------|--------|-----|------|-------|
| PROC001 | 調達管理トップ | `/procurement` | 資材・生産・管理者 | Phase 2 |
| PROC002 | 予定入荷管理 | `/procurement` | 資材・生産・管理者 | Phase 2 |
| PROC003 | 発注アラート | (調達管理に統合) | 資材・生産・管理者 | Phase 2 |

### 🗃️ マスタ管理（5画面）
| 画面ID | 画面名 | URL | 権限 | Phase |
|--------|--------|-----|------|-------|
| MAST001 | マスタ管理トップ | `/masters` | 管理者 | Phase 3 |
| MAST002 | 部品マスタ一覧 | `/masters/parts` | 管理者 | Phase 3 |
| MAST003 | 製品マスタ一覧 | `/masters/products` | 管理者 | Phase 3 |
| MAST004 | BOMマスタ管理 | `/masters/bom` | 管理者 | Phase 3 |
| MAST005 | ユーザー管理 | `/masters/users` | 管理者 | Phase 3 |

### 📊 レポート（4画面）
| 画面ID | 画面名 | URL | 権限 | Phase |
|--------|--------|-----|------|-------|
| REP001 | レポートトップ | `/reports` | 全員 | 将来拡張 |
| REP002 | 在庫レポート | `/reports/inventory` | 全員 | 将来拡張 |
| REP003 | 不足分析レポート | `/reports/shortage` | 全員 | 将来拡張 |
| REP004 | ダッシュボードレポート | `/reports/dashboard` | 全員 | 将来拡張 |

### 🚨 エラー・共通（3画面）
| 画面ID | 画面名 | URL | 権限 | Phase |
|--------|--------|-----|------|-------|
| ERR001 | 404ページ | `/not-found` | なし | Phase 1 |
| ERR002 | 共通ローディング | `/loading` | なし | Phase 1 |
| ERR003 | 共通エラー | `/error` | なし | Phase 1 |

---

## 📋 Phase 2: 実装済み画面詳細仕様

### 🏠 DASH002: 詳細ダッシュボード

- **URL**: `/dashboard`
- **目的**: システム全体の状況を可視化し、重要な指標（KPI）やアラートを提示する。
- **画面構成**:
    - **緊急アラート**: 緊急不足部品や遅延入荷など、即時対応が必要な項目を表示。
    - **KPI概要カード**: 不足部品総数、入荷予定件数、仕入先総数などをカード形式で表示。
    - **詳細情報セクション**: 不足部品、入荷予定、仕入先、棚卸の状況をより詳細に表示。
    - **クイックアクション**: 各主要機能（部材管理、調達管理、生産計画）へのナビゲーションリンク。
- **機能詳細**:
    - バックエンドAPI `/api/reports/dashboard` からデータを取得し、動的に画面を生成。
    - ローディング、エラー、データなしの各状態に対応したUIを表示。
    - 各カードやボタンクリックで関連ページ（在庫一覧、調達管理など）へ遷移。
- **使用API**: `GET /api/reports/dashboard`

### 📦 INV002: 在庫一覧・管理画面

- **URL**: `/inventory`
- **目的**: 在庫状況の確認、検索、および在庫調整、棚卸を行う。
- **画面構成**:
    - **ヘッダー**: 「棚卸」「予約データ同期」ボタンを配置。
    - **概要統計**: 総部品数、生産不足件数、安全在庫割れ件数を表示。
    - **棚卸機能**: 棚卸対象の部品追加、実地数量の入力、差異理由の選択、棚卸実行機能。
    - **検索・フィルタ**: 部品コード、カテゴリ、状態（生産不足、安全在庫割れ）での絞り込み。
    - **データテーブル**: 在庫情報を一覧表示。クリックで部品詳細モーダルを開く。
- **機能詳細**:
    - **在庫一覧**: リアルタイムの在庫状況（現在庫、予約済、利用可能）を表示。
    - **部品詳細モーダル**:
        - **詳細情報タブ**: 部品の基本情報と詳細な在庫情報を表示。
        - **入出庫履歴タブ**: 当該部品のすべての在庫トランザクション履歴を表示。
        - **在庫調整タブ**: 手動での入庫・出庫処理を実行可能（権限要）。
    - **棚卸**: 複数の部品をリストに追加し、一括で棚卸処理を実行。
    - **予約データ同期**: 生産計画の変更を在庫予約に反映させる。
- **使用API**:
    - `GET /api/inventory`, `GET /api/inventory/:part_code`, `GET /api/inventory/:part_code/history`
    - `POST /api/inventory/:part_code/receipt`, `POST /api/inventory/:part_code/issue`
    - `POST /api/stocktaking/execute`
    - `POST /api/inventory/sync-reservations`

### 🚚 PROC002: 調達管理画面

- **URL**: `/procurement`
- **目的**: 発注から入荷までの一連の調達業務を管理する。
- **画面構成**:
    - **アクションボタン**: 「新規発注」「不足部品一覧」の表示切り替え。
    - **検索・フィルタ**: ステータス、部品コードでの絞り込み。
    - **不足部品一覧**: 生産に影響のある不足部品をリストアップし、直接発注が可能。
    - **調達一覧テーブル**: 全ての発注状況を一覧表示。
- **機能詳細**:
    - **新規発注**: モーダルフォームから新しい発注を作成。
    - **納期回答**: 「納期回答待ち」ステータスの発注に対し、予定入荷日と数量を登録。
    - **入荷処理**: 「入荷予定」ステータスの発注に対し、統合入荷APIを用いて入荷処理を実行。
    - **発注キャンセル**: 入荷済み以外の発注をキャンセル（論理削除）。
    - **行のハイライト**: 納期遅延や納期間近の予定を色分けして警告。
- **使用API**:
    - `GET /api/scheduled-receipts`, `POST /api/scheduled-receipts`
    - `PUT /api/scheduled-receipts/:id/delivery-response`
    - `PUT /api/scheduled-receipts/:id/cancel`
    - `POST /api/inventory/:part_code/integrated-receipt`
    - `GET /api/reports/shortage-parts/procurement-needed`

### 🏭 PROD002: 生産計画管理画面

- **URL**: `/production`
- **目的**: 生産計画の立案、進捗管理、および必要部材の所要量計算を行う。
- **画面構成**:
    - **アクションボタン**: 「新規計画作成」。
    - **検索・フィルタ**: 製品コード、ステータス、棟番号、開始日で絞り込み。
    - **生産計画テーブル**: 全ての生産計画を一覧表示。
- **機能詳細**:
    - **新規計画作成**: モーダルフォームから製品、数量、開始日などを指定して新しい計画を作成。
    - **所要量計算**: 各計画ごとに、必要部材と現在の在庫を比較し、不足状況を計算・表示。
    - **ステータス更新**:
        - **生産開始**: 「計画」ステータスから部材を消費して「生産中」へ移行。
        - **生産完了**: 「生産中」ステータスから「完了」へ移行。
        - **削除**: 「完了」以外の計画を削除可能。
    - **不足警告**: 部材が不足している計画には警告アイコンを表示。
- **使用API**:
    - `GET /api/plans`, `POST /api/plans`, `DELETE /api/plans/:id`
    - `POST /api/plans/:id/requirements`
    - `POST /api/plans/:id/start-production`
    - `POST /api/plans/:id/complete-production`

---

## 🎨 共通UI仕様

### デザインシステム
```css
/* カラーパレット */
:root {
  --primary-50: #eff6ff;
  --primary-500: #3b82f6;
  --primary-600: #2563eb;
  --success-500: #22c55e;
  --warning-500: #f59e0b;
  --danger-500: #ef4444;
  --gray-50: #f9fafb;
  --gray-500: #6b7280;
  --gray-900: #111827;
}

/* 共通コンポーネントクラス */
.btn-primary { /* プライマリボタン */ }
.btn-secondary { /* セカンダリボタン */ }
.btn-danger { /* 危険操作ボタン */ }
.card-base { /* カード型コンテナ */ }
.input-base { /* 入力フィールド */ }
.table-base { /* テーブル */ }
```

### レスポンシブ対応
- **デスクトップ**: 1280px以上（フル機能）
- **タブレット**: 768px-1279px（主要機能）
- **スマホ**: 767px以下（基本機能のみ）

### アクセシビリティ
- カラーコントラスト比: WCAG AA準拠
- キーボード操作: Tab順序の最適化
- スクリーンリーダー: 適切なaria-label設定

---

## 🔧 技術実装要件

### パフォーマンス要件
- **初期表示**: 3秒以内
- **検索結果**: 2秒以内
- **画面遷移**: 1秒以内

### セキュリティ要件
- **JWT認証**: 全API通信でトークン検証
- **権限制御**: ページ・UI要素レベルでの制御
- **入力検証**: クライアント + サーバーサイド両方

### エラーハンドリング
- **ネットワークエラー**: 再試行ボタン表示
- **権限エラー**: 適切なメッセージと代替操作
- **バリデーションエラー**: 項目別エラー表示

---

## 📅 開発スケジュール

### Phase 2: 在庫管理画面（Week 3-5）
- **Week 3**: INV001, INV002 実装
- **Week 4**: INV003 実装  
- **Week 5**: INV004 実装 + テスト

### 次フェーズ準備
- **共通コンポーネント**: Button, Table, Modal等
- **API Service層**: 各画面共通の通信処理
- **状態管理**: React Query設定

---

## ✅ 承認・確認事項

### 仕様確認必要項目
- [ ] 在庫不足の基準（安全在庫基準で良いか）
- [ ] CSV出力項目（現在の項目で十分か）
- [ ] 予定入荷連携の詳細フロー
- [ ] 権限制御の細かい制御レベル

### 技術的確認事項
- [ ] バックエンドAPI仕様との整合性
- [ ] データベーステーブル構造との整合性
- [ ] 既存認証システムとの連携
