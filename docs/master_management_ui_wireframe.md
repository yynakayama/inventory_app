# マスター管理機能 UI/UXワイヤーフレーム設計書

## 📋 概要

本ドキュメントは、在庫管理システムのマスター管理機能のUI/UX設計を定義します。
既存画面（在庫管理、調達管理）との一貫性を保ちながら、効率的なマスター管理を実現します。

### 設計原則
- **一貫性**: 既存画面のUIパターンを踏襲
- **効率性**: タブ切り替えによる統合管理
- **権限制御**: 管理者のみアクセス可能
- **レスポンシブ**: デスクトップ・タブレット対応

---

## 🎯 画面構成概要

### URL構造
```
/masters                    # マスター管理トップ（リダイレクト）
/masters/parts             # 部品マスター管理
/masters/products          # 製品マスター管理  
/masters/bom               # BOM管理
/masters/users             # ユーザー管理
```

### ナビゲーション統合
既存のHeader.tsxに「マスタ管理」メニューが実装済み：
```typescript
{
  label: 'マスタ管理',
  href: '/masters',
  roles: ['admin'], // 管理者のみ
  children: [
    { label: '部品マスタ', href: '/masters/parts' },
    { label: '製品マスタ', href: '/masters/products' },
    { label: 'BOM管理', href: '/masters/bom' },
    { label: 'ユーザー管理', href: '/masters/users' },
  ]
}
```

---

## 📱 1. 共通レイアウト設計

### 1.1 ページ構造
```
┌─────────────────────────────────────────────────────────────┐
│ Header (既存)                                                │
├─────────────────────────────────────────────────────────────┤
│ ┌─ Breadcrumb ─────────────────────────────────────────────┐ │
│ │ ホーム > マスタ管理 > [現在のタブ]                        │ │
│ └─────────────────────────────────────────────────────────┘ │
│ ┌─ Page Header ────────────────────────────────────────────┐ │
│ │ 🗃️ マスター管理                    [最終更新: 時刻]      │ │
│ │ システムの基本データを一元管理します                      │ │
│ └─────────────────────────────────────────────────────────┘ │
│ ┌─ Tab Navigation ─────────────────────────────────────────┐ │
│ │ [部品マスター] [製品マスター] [BOM管理] [ユーザー管理]    │ │
│ └─────────────────────────────────────────────────────────┘ │
│ ┌─ Tab Content ────────────────────────────────────────────┐ │
│ │                                                          │ │
│ │ [各タブの個別コンテンツ]                                  │ │
│ │                                                          │ │
│ └─────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────┘
```

### 1.2 共通UIコンポーネント活用
- **Button**: 既存の`components/ui/Button.tsx`を使用
- **Modal**: 既存の`components/ui/Modal.tsx`を使用
- **PartCodeSelector**: 既存の`components/ui/PartCodeSelector.tsx`を活用
- **権限制御**: 既存の`components/guards/PermissionGuard.tsx`を使用

### 1.3 カラーパレット（既存準拠）
```css
/* 既存のTailwind設定に準拠 */
--primary: #3b82f6 (blue-600)
--success: #22c55e (green-500)  
--warning: #f59e0b (yellow-500)
--danger: #ef4444 (red-500)
--gray: #6b7280 (gray-500)
```

---

## 🔧 2. 部品マスター管理画面

### 2.1 画面レイアウト
```
┌─ Action Bar ──────────────────────────────────────────────────┐
│ [🔍 検索・フィルタ] [➕ 新規登録] [📤 CSV出力] [🔄 更新]      │
└───────────────────────────────────────────────────────────────┘
┌─ Search & Filter Panel ───────────────────────────────────────┐
│ ┌─部品コード─┐ ┌─カテゴリ─┐ ┌─仕入先─┐ ┌─状態─┐ [検索] [リセット] │
│ │           │ │         │ │       │ │     │                │
│ └───────────┘ └─────────┘ └───────┘ └─────┘                │
└───────────────────────────────────────────────────────────────┘
┌─ Statistics Cards ────────────────────────────────────────────┐
│ ┌─総部品数─┐ ┌─アクティブ─┐ ┌─カテゴリ数─┐                    │
│ │   150   │ │    142    │ │     8     │                    │
│ └─────────┘ └───────────┘ └───────────┘                    │
└───────────────────────────────────────────────────────────────┘
┌─ Data Table ──────────────────────────────────────────────────┐
│ ┌─────────────────────────────────────────────────────────────┐ │
│ │部品コード│規格・仕様│カテゴリ│仕入先│単価│リードタイム│操作│ │
│ ├─────────────────────────────────────────────────────────────┤ │
│ │MECH-001 │M6ボルト  │MECH   │ABC商事│50 │7日        │[編集]│ │
│ │ELEC-001 │抵抗器    │ELEC   │XYZ電子│25 │3日        │[編集]│ │
│ │...      │...       │...    │...   │..│...        │...  │ │
│ └─────────────────────────────────────────────────────────────┘ │
└───────────────────────────────────────────────────────────────┘
┌─ Pagination ──────────────────────────────────────────────────┐
│ [<] 1 2 3 ... 10 [>]                    表示: 1-20 / 150件   │
└───────────────────────────────────────────────────────────────┘
```

### 2.2 新規登録・編集モーダル
```
┌─ Modal: 部品マスター登録/編集 ─────────────────────────────────┐
│ ┌─ Header ──────────────────────────────────────────────────┐ │
│ │ 🔧 部品マスター登録                              [✕]     │ │
│ │ 新しい部品情報を登録します                                │ │
│ └───────────────────────────────────────────────────────────┘ │
│ ┌─ Form Content ────────────────────────────────────────────┐ │
│ │ ┌─部品コード (必須)─┐ ┌─規格・仕様─────────────────────┐   │ │
│ │ │ MECH-002         │ │ M8ボルト 25mm ステンレス      │   │ │
│ │ └──────────────────┘ └───────────────────────────────┘   │ │
│ │ ┌─単位─┐ ┌─カテゴリ─┐ ┌─仕入先─────────┐ ┌─単価─────┐   │ │
│ │ │ 個  │ │ MECH    │ │ ABC商事        │ │ 75.00   │   │ │
│ │ └─────┘ └─────────┘ └────────────────┘ └──────────┘   │ │
│ │ ┌─リードタイム─┐ ┌─安全在庫─┐ ┌─有効/無効─┐             │ │
│ │ │ 7日         │ │ 50個    │ │ ✅ 有効   │             │ │
│ │ └─────────────┘ └─────────┘ └───────────┘             │ │
│ │ ┌─備考─────────────────────────────────────────────────┐   │ │
│ │ │                                                    │   │ │
│ │ └────────────────────────────────────────────────────┘   │ │
│ └───────────────────────────────────────────────────────────┘ │
│ ┌─ Footer ──────────────────────────────────────────────────┐ │
│ │                                    [キャンセル] [登録]    │ │
│ └───────────────────────────────────────────────────────────┘ │
└───────────────────────────────────────────────────────────────┘
```

### 2.3 操作フロー
1. **一覧表示**: 部品マスター一覧をテーブル形式で表示
2. **検索・フィルタ**: 部品コード、カテゴリ、仕入先での絞り込み
3. **新規登録**: モーダルフォームで新規部品を登録
4. **編集**: 行の「編集」ボタンでモーダル編集
5. **有効/無効切り替え**: 行のトグルボタンで状態変更

---

## 🏭 3. 製品・BOM管理画面

### 3.1 画面レイアウト（2ペイン構成）
```
┌─ Action Bar ──────────────────────────────────────────────────┐
│ [➕ 新規製品] [🔄 更新]                                        │
└───────────────────────────────────────────────────────────────┘
┌─ Left Pane: 製品一覧 ─┐ ┌─ Right Pane: BOM詳細 ──────────────┐
│ ┌─ Search ──────────┐ │ │ ┌─ Product Info ─────────────────┐ │
│ │ 製品コード検索    │ │ │ │ 📦 製品: PROD-001             │ │
│ └───────────────────┘ │ │ │ 備考: 製品A                   │ │
│ ┌─ Product List ────┐ │ │ └───────────────────────────────┘ │
│ │ ┌─PROD-001──────┐ │ │ │ ┌─ Station Tabs ─────────────────┐ │
│ │ │製品A         │◀┼─┼─│ │[ST-001][ST-002][ST-003]      │ │
│ │ │2024/01/01    │ │ │ │ └───────────────────────────────┘ │
│ │ └──────────────┘ │ │ │ ┌─ BOM Table ────────────────────┐ │
│ │ ┌─PROD-002──────┐ │ │ │ │部品コード│仕様│数量│単位│操作│ │
│ │ │製品B         │ │ │ │ ├─────────────────────────────┤ │
│ │ │2024/01/02    │ │ │ │ │MECH-001 │M6 │ 2 │個 │[編集]│ │
│ │ └──────────────┘ │ │ │ │ELEC-001 │抵抗│ 1 │個 │[削除]│ │
│ │ ...              │ │ │ └───────────────────────────────┘ │
│ └───────────────────┘ │ │ [➕ 部品追加]                    │
└───────────────────────┘ └─────────────────────────────────────┘
```

### 3.2 BOM項目追加モーダル
```
┌─ Modal: BOM項目追加 ───────────────────────────────────────────┐
│ ┌─ Header ──────────────────────────────────────────────────┐ │
│ │ ➕ BOM項目追加                                   [✕]     │ │
│ │ 製品: PROD-001 工程: ST-001 に部品を追加します            │ │
│ └───────────────────────────────────────────────────────────┘ │
│ ┌─ Form Content ────────────────────────────────────────────┐ │
│ │ ┌─部品コード (必須)─────────────────────────────────────┐   │ │
│ │ │ [PartCodeSelector] MECH-001                         │   │ │
│ │ └─────────────────────────────────────────────────────┘   │ │
│ │ ┌─使用数量─┐ ┌─単位─┐                                     │ │
│ │ │ 2       │ │ 個  │                                     │ │
│ │ └─────────┘ └─────┘                                     │ │
│ │ ┌─備考─────────────────────────────────────────────────┐   │ │
│ │ │                                                    │   │ │
│ │ └────────────────────────────────────────────────────┘   │ │
│ └───────────────────────────────────────────────────────────┘ │
│ ┌─ Footer ──────────────────────────────────────────────────┐ │
│ │                                    [キャンセル] [追加]    │ │
│ └───────────────────────────────────────────────────────────┘ │
└───────────────────────────────────────────────────────────────┘
```

### 3.3 操作フロー
1. **製品選択**: 左ペインで製品を選択
2. **工程選択**: 右ペインのタブで工程を選択
3. **BOM表示**: 選択された製品・工程のBOM一覧を表示
4. **部品追加**: 「部品追加」ボタンでモーダル表示
5. **編集・削除**: 各行の操作ボタンで編集・削除

---

## 👥 4. ユーザー管理画面

### 4.1 画面レイアウト
```
┌─ Action Bar ──────────────────────────────────────────────────┐
│ [➕ 新規ユーザー] [📤 CSV出力] [🔄 更新]                       │
└───────────────────────────────────────────────────────────────┘
┌─ Search & Filter Panel ───────────────────────────────────────┐
│ ┌─ユーザー名─┐ ┌─権限レベル─┐ ┌─状態─┐ [検索] [リセット]      │
│ │           │ │ 全て      │ │ 全て │                        │
│ └───────────┘ └───────────┘ └─────┘                        │
└───────────────────────────────────────────────────────────────┘
┌─ Statistics Cards ────────────────────────────────────────────┐
│ ┌─総ユーザー数─┐ ┌─アクティブ─┐ ┌─管理者─┐ ┌─最終ログイン─┐   │
│ │     12      │ │     10    │ │   2   │ │  2時間前    │   │
│ └─────────────┘ └───────────┘ └───────┘ └─────────────┘   │
└───────────────────────────────────────────────────────────────┘
┌─ Data Table ──────────────────────────────────────────────────┐
│ ┌─────────────────────────────────────────────────────────────┐ │
│ │ユーザー名│メール│権限│状態│最終ログイン│作成日│操作        │ │
│ ├─────────────────────────────────────────────────────────────┤ │
│ │admin    │admin@│管理│🟢  │2時間前     │1/1  │[編集][無効]│ │
│ │user001  │-    │資材│🟢  │1日前       │1/2  │[編集][無効]│ │
│ │user002  │user@│閲覧│🔴  │1週間前     │1/3  │[編集][有効]│ │
│ └─────────────────────────────────────────────────────────────┘ │
└───────────────────────────────────────────────────────────────┘
```

### 4.2 ユーザー登録・編集モーダル
```
┌─ Modal: ユーザー登録/編集 ─────────────────────────────────────┐
│ ┌─ Header ──────────────────────────────────────────────────┐ │
│ │ 👤 ユーザー登録                                  [✕]     │ │
│ │ 新しいユーザーアカウントを作成します                      │ │
│ └───────────────────────────────────────────────────────────┘ │
│ ┌─ Form Content ────────────────────────────────────────────┐ │
│ │ ┌─ユーザー名 (必須)─┐ ┌─メールアドレス (任意)──────────┐   │ │
│ │ │ user003          │ │ user003@example.com          │   │ │
│ │ └──────────────────┘ └──────────────────────────────┘   │ │
│ │ ┌─パスワード (必須)─────────────────────────────────────┐   │ │
│ │ │ ••••••••                                           │   │ │
│ │ └─────────────────────────────────────────────────────┘   │ │
│ │ ┌─権限レベル─┐ ┌─アカウント状態─┐                         │ │
│ │ │ 資材担当   │ │ ✅ 有効       │                         │ │
│ │ └───────────┘ └───────────────┘                         │ │
│ └───────────────────────────────────────────────────────────┘ │
│ ┌─ Footer ──────────────────────────────────────────────────┐ │
│ │                                    [キャンセル] [登録]    │ │
│ └───────────────────────────────────────────────────────────┘ │
└───────────────────────────────────────────────────────────────┘
```

### 4.3 パスワードリセットモーダル
```
┌─ Modal: パスワードリセット ────────────────────────────────────┐
│ ┌─ Header ──────────────────────────────────────────────────┐ │
│ │ 🔑 パスワードリセット                            [✕]     │ │
│ │ ユーザー: user003 のパスワードをリセットします            │ │
│ └───────────────────────────────────────────────────────────┘ │
│ ┌─ Form Content ────────────────────────────────────────────┐ │
│ │ ⚠️ 注意: この操作により、対象ユーザーは新しいパスワード   │ │
│ │ でのログインが必要になります。                            │ │
│ │                                                          │ │
│ │ ┌─新しいパスワード─────────────────────────────────────┐   │ │
│ │ │ ••••••••                                           │   │ │
│ │ └─────────────────────────────────────────────────────┘   │ │
│ │ ┌─パスワード確認───────────────────────────────────────┐   │ │
│ │ │ ••••••••                                           │   │ │
│ │ └─────────────────────────────────────────────────────┘   │ │
│ └───────────────────────────────────────────────────────────┘ │
│ ┌─ Footer ──────────────────────────────────────────────────┐ │
│ │                                    [キャンセル] [リセット]│ │
│ └───────────────────────────────────────────────────────────┘ │
└───────────────────────────────────────────────────────────────┘
```

### 4.4 操作フロー
1. **一覧表示**: ユーザー一覧をテーブル形式で表示
2. **検索・フィルタ**: ユーザー名、権限、状態での絞り込み
3. **新規登録**: モーダルフォームで新規ユーザーを作成
4. **編集**: 行の「編集」ボタンでユーザー情報編集
5. **有効/無効切り替え**: 行のボタンでアカウント状態変更
6. **パスワードリセット**: 編集モーダル内でパスワードリセット

---

## 📱 5. レスポンシブ対応

### 5.1 ブレークポイント
```css
/* Tailwind CSS準拠 */
sm: 640px   /* タブレット縦 */
md: 768px   /* タブレット横 */
lg: 1024px  /* デスクトップ */
xl: 1280px  /* 大画面 */
```

### 5.2 タブレット対応（768px-1023px）
- **タブナビゲーション**: 横スクロール対応
- **テーブル**: 横スクロール + 重要列の固定
- **モーダル**: 幅調整（max-w-lg → max-w-md）
- **フォーム**: 2列 → 1列レイアウト

### 5.3 スマートフォン対応（767px以下）
- **基本機能のみ**: 参照機能中心
- **カード形式**: テーブル → カードレイアウト
- **簡略化**: 操作ボタンの統合

---

## 🎨 6. UIコンポーネント設計

### 6.1 新規作成コンポーネント

#### MasterTabNavigation
```typescript
interface MasterTabNavigationProps {
  activeTab: 'parts' | 'products' | 'bom' | 'users'
  onTabChange: (tab: string) => void
}
```

#### MasterDataTable
```typescript
interface MasterDataTableProps<T> {
  data: T[]
  columns: ColumnDef<T>[]
  loading?: boolean
  onEdit?: (item: T) => void
  onDelete?: (item: T) => void
  onToggleActive?: (item: T) => void
}
```

#### MasterSearchFilters
```typescript
interface MasterSearchFiltersProps {
  filters: Record<string, any>
  onFiltersChange: (filters: Record<string, any>) => void
  onSearch: () => void
  onReset: () => void
  children?: ReactNode
}
```

### 6.2 既存コンポーネント拡張

#### Button（既存活用）
- `variant="primary"`: 主要操作（登録、更新）
- `variant="secondary"`: 補助操作（キャンセル、リセット）
- `variant="danger"`: 削除操作
- `size="sm"`: テーブル内操作ボタン

#### Modal（既存活用）
- `size="md"`: 標準フォーム
- `size="lg"`: 複雑フォーム（BOM管理）
- `showFooter={true}`: 操作ボタン表示

---

## 🔐 7. 権限制御設計

### 7.1 ページレベル制御
```typescript
// 全マスター管理画面で管理者権限チェック
<RouteGuard>
  <PermissionGuard requiredPermissions={['admin']}>
    <MasterManagementContent />
  </PermissionGuard>
</RouteGuard>
```

### 7.2 機能レベル制御
```typescript
// 編集・削除ボタンの表示制御
<PermissionGuard requiredPermissions={['admin']}>
  <Button onClick={handleEdit}>編集</Button>
  <Button onClick={handleDelete} variant="danger">削除</Button>
</PermissionGuard>
```

### 7.3 データレベル制御
- **自分自身の編集制限**: ユーザー管理で自分のアカウント編集不可
- **最後の管理者保護**: 管理者が1人の場合は削除・無効化不可

---

## 📊 8. データフロー設計

### 8.1 状態管理パターン
```typescript
// 各タブで共通の状態管理パターン
const [data, setData] = useState<T[]>([])
const [loading, setLoading] = useState(false)
const [error, setError] = useState<string | null>(null)
const [filters, setFilters] = useState<FilterType>({})
const [selectedItem, setSelectedItem] = useState<T | null>(null)
const [showModal, setShowModal] = useState(false)
```

### 8.2 API呼び出しパターン
```typescript
// 既存パターンに準拠したAPI呼び出し
const fetchData = async () => {
  try {
    setLoading(true)
    setError(null)
    
    const token = localStorage.getItem('token')
    const response = await fetch(`${API_BASE_URL}/${endpoint}`, {
      headers: { 'Authorization': `Bearer ${token}` }
    })
    
    if (!response.ok) throw new Error('データ取得に失敗しました')
    
    const result = await response.json()
    if (result.success) {
      setData(result.data)
    } else {
      throw new Error(result.message)
    }
  } catch (err) {
    setError(err.message)
  } finally {
    setLoading(false)
  }
}
```

---

## 🚀 9. 実装優先度

### Phase 1: 基盤実装
1. **共通レイアウト**: タブナビゲーション、ページ構造
2. **部品マスター**: 既存API活用、基本CRUD
3. **権限制御**: 管理者のみアクセス制御

### Phase 2: 機能拡張
1. **製品・BOM管理**: 2ペイン構成、既存API活用
2. **ユーザー管理**: 新規API実装、CRUD機能

### Phase 3: UX向上
1. **検索・フィルタ**: 高度な絞り込み機能
2. **レスポンシブ**: タブレット・スマホ対応
3. **CSV出力**: データエクスポート機能

---

## ✅ 10. 実装チェックリスト

### 基本機能
- [ ] タブナビゲーション実装
- [ ] 部品マスター一覧・CRUD
- [ ] 製品マスター一覧・CRUD
- [ ] BOM管理（2ペイン構成）
- [ ] ユーザー管理一覧・CRUD

### UI/UX
- [ ] 既存デザインシステム準拠
- [ ] レスポンシブ対応
- [ ] ローディング・エラー状態
- [ ] 操作フィードバック（成功・失敗メッセージ）

### 権限制御
- [ ] 管理者のみアクセス制御
- [ ] 自分自身の編集制限
- [ ] 最後の管理者保護

### データ整合性
- [ ] バリデーション実装
- [ ] 重複チェック
- [ ] 関連データ整合性確認

---

この設計書に基づいて、既存のUIパターンを活用しながら効率的なマスター管理機能を実装できます。特に既存の`Button`、`Modal`、`PermissionGuard`コンポーネントを最大限活用することで、一貫性のあるUIを実現できます。